check process unicorn with pidfile <%= @locals[:deploy_to] %>/shared/pids/unicorn.pid
    start program = "/bin/bash -c '/etc/init.d/unicorn start & >> /tmp/unicorn-monit.log'"
    stop program = "/etc/init.d/unicorn stop"

<% @locals[:unicorn_workers].times do |n| %>
    <% pid = "#{@locals[:deploy_to]}/shared/pids/unicorn.#{n}.pid" %>
    check process <%= @application %>_unicorn_worker_<%= n %> with pidfile <%= pid %>
    start program = "/bin/true"
    stop program = "/usr/bin/test -s <%= pid %> && /bin/kill -QUIT `cat <%= pid %>`"
    if mem > 250.0 MB for 1 cycles then restart
    if cpu > 50% for 3 cycles then restart
    if 5 restarts within 5 cycles then timeout
    alert webops@walkerandcobrands.com only on { pid }
    if changed pid 2 times within 60 cycles then alert
<% end %>
